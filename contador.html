<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Contador de Euros</title>
    <script src="https://kit.fontawesome.com/4425ac96dd.js" crossorigin="anonymous"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding-top: 20px;
            text-align: center;
            background-color: #f3f3f3;
        }

        #contador {
            font-size: 5em;
            margin: 20px;
            color: #2e7d32;
        }

        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 1em;
            cursor: pointer;
        }

        input[type="number"] {
            padding: 10px;
            font-size: 1em;
            width: 120px;
        }

        #estado {
            margin-top: 15px;
            font-weight: bold;
            color: #555;
        }

        #btnReanudar.activo {
            background-color: #c8e6c9;
            border: 1px solid #2e7d32;
            color: #2e7d32;
        }

        .resultadoGananciaBox {
            min-height: 1.5em;
            width: 250px;
        }

        h1 {
            margin-top: 5px;
            ;
        }

        #contenedorCalculadoras {
            max-height: 1000px;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        #contenedorCalculadoras.oculto {
            max-height: 0;
            padding: 0;
            margin: 0;
        }

        #contenedorP{
            position: relative;
        }
        #flechaToggle{
            position: absolute;
            top: 0;
            right: 0;
            margin-right: 40px;
            transform: scale(1.5);
        }
    </style>
</head>

<body>

    <h1>Contador </h1>
    <div id="contador">0.000 €</div>

    <button onclick="pausarContador()">Pausar</button>
    <button id="btnReanudar" onclick="reanudarContador()">Reanudar</button>
    <button onclick="limpiarContador()">Limpiar</button>

    <div style="margin-top:20px;">
        <input type="number" id="montoAgregar" step="0.001" placeholder="Añadir €">
        <button onclick="agregarDinero()">Añadir</button>
    </div>

    <div id="estado">Estado: <span id="estadoTexto">En pausa</span></div>

    <hr style="margin: 15px 0;">
    <div style="margin-top: 5px;" id="contenedorP">
        <p id="flechaToggle" style="cursor:pointer;"><i class="fa-solid fa-plus"></i></p>
        <div id="contenedorCalculadoras" class="oculto">

            <button onclick="alternarModo()" style="margin-top: 10px; background-color: rgb(216, 216, 154);">Cambiar
                calculadora</button>
            <div id="calculadoraNormal" style="margin-top: 40px;">
                <h2>Calculadora de Ganancia</h2>

                <div style="display: flex;  align-items:center;justify-content:space-evenly; margin-bottom: 20px;">
                    <div>
                        <label for="diasInput" style="margin-bottom: 5px; font-weight: bold;">Días</label><br>
                        <input type="number" id="diasInput" min="0" placeholder="0"
                            style="width: 80px;margin-top: 8px;">
                        <div id="resultadoGanancia" class="resultadoGananciaBox"
                            style="margin-top: 8px; font-weight: bold;"></div>
                    </div>

                    <div>
                        <label for="horasInput" style="margin-bottom: 5px; font-weight: bold;">Horas</label><br>
                        <input type="number" id="horasInput" min="0" placeholder="0"
                            style="width: 80px;margin-top: 8px;">
                        <div id="resultadoGananciaHoras" class="resultadoGananciaBox"
                            style="margin-top: 8px; font-weight: bold;"></div>
                    </div>

                    <div>
                        <label for="minutosInput" style="margin-bottom: 5px; font-weight: bold;">Minutos</label><br>
                        <input type="number" id="minutosInput" min="0" placeholder="0"
                            style="width: 80px;margin-top: 8px;">
                        <div id="resultadoGananciaMinutos" class="resultadoGananciaBox"
                            style="margin-top: 8px; font-weight: bold;"></div>
                    </div>
                </div>
                <div id="resultadoTotal" style="margin-top: 20px; font-size: 18px; font-weight: bold; color: green;">
                </div>

                <button onclick="calcularTodas()"
                    style="margin-top: 10px; background-color: #14991b;color:white;">Calcular</button>
            </div>

            <div id="calculadoraInversa" style="display: none; margin-top: 5px;">
                <h2>Calculadora Inversa</h2>
                <input type="number" id="montoInverso" step="0.01" placeholder="Introduce €" style="width: 200px;">
                <button onclick="calcularInverso()" style="margin-left: 10px;">Calcular tiempo</button>

                <div id="resultadoInverso" style="margin-top: 20px; font-weight: bold;"></div>

                <!-- ESTE BOTÓN FALTABA -->
                <button id="btnAgregarInverso" onclick="agregarDineroDesdeInverso()"
                    style="margin-top: 10px; display: none;">
                    Añadir este monto al contador
                </button>


            </div>
        </div>
    </div> <!-- CIERRE de contenedorCalculadoras -->
    </div>



    <script>
        let valor = 0.000;
        let activo = false;
        let intervalo = null;
        const incrementoPorSegundo = 0.00221;

        let ultimoTiempo = Date.now();

        const contadorElem = document.getElementById("contador");
        const btnReanudar = document.getElementById("btnReanudar");
        const estadoTexto = document.getElementById("estadoTexto");

        // Cargar valor y estado previo
        if (localStorage.getItem("valorContador")) {
            valor = parseFloat(localStorage.getItem("valorContador"));
        }
        if (localStorage.getItem("ultimoTiempo")) {
            ultimoTiempo = parseInt(localStorage.getItem("ultimoTiempo"));
        }

        function actualizarContador() {
            contadorElem.textContent = valor.toFixed(3) + " €";
            localStorage.setItem("valorContador", valor.toFixed(3));
        }

        function actualizarEstadoVisual() {
            if (activo) {
                btnReanudar.classList.add("activo");
                btnReanudar.textContent = "En marcha";
                estadoTexto.textContent = "En marcha";
            } else {
                btnReanudar.classList.remove("activo");
                btnReanudar.textContent = "Reanudar";
                estadoTexto.textContent = "En pausa";
            }
        }

        function calcularTodas() {
            const dias = parseInt(document.getElementById("diasInput").value) || 0;
            const horas = parseInt(document.getElementById("horasInput").value) || 0;
            const minutos = parseInt(document.getElementById("minutosInput").value) || 0;

            const segundosDias = dias * 8 * 60 * 60;
            const segundosHoras = horas * 60 * 60;
            const segundosMinutos = minutos * 60;

            const gananciaDias = segundosDias * incrementoPorSegundo;
            const gananciaHoras = segundosHoras * incrementoPorSegundo;
            const gananciaMinutos = segundosMinutos * incrementoPorSegundo;

            const total = gananciaDias + gananciaHoras + gananciaMinutos;

            document.getElementById("resultadoGanancia").textContent = `Ganancia por días: ${gananciaDias.toFixed(2)} €`;
            document.getElementById("resultadoGananciaHoras").textContent = `Ganancia por horas: ${gananciaHoras.toFixed(2)} €`;
            document.getElementById("resultadoGananciaMinutos").textContent = `Ganancia por minutos: ${gananciaMinutos.toFixed(2)} €`;
            document.getElementById("resultadoTotal").textContent = `Ganancia total estimada: ${total.toFixed(2)} €`;

            document.getElementById("montoAgregar").value = total.toFixed(4);
        }


        function loop() {
            const ahora = Date.now();
            const segundosPasados = (ahora - ultimoTiempo) / 1000;
            ultimoTiempo = ahora;

            if (activo) {
                valor += incrementoPorSegundo * segundosPasados;
                actualizarContador();
            }

            localStorage.setItem("ultimoTiempo", ultimoTiempo.toString());
            requestAnimationFrame(loop); // más fiable que setInterval
        }

        function pausarContador() {
            activo = false;
            actualizarEstadoVisual();
        }

        function reanudarContador() {
            activo = true;
            ultimoTiempo = Date.now();
            actualizarEstadoVisual();
        }

        function limpiarContador() {
            pausarContador();
            valor = 0.000;
            actualizarContador();
        }

        function agregarDinero() {
            const monto = parseFloat(document.getElementById("montoAgregar").value);
            if (!isNaN(monto)) {
                valor += monto;
                actualizarContador();
                document.getElementById("montoAgregar").value = "";
            } else {
                alert("Introduce una cantidad válida.");
            }
        }

        // Guardar antes de cerrar
        window.addEventListener("beforeunload", () => {
            localStorage.setItem("valorContador", valor.toFixed(3));
            localStorage.setItem("ultimoTiempo", Date.now().toString());
        });

        actualizarContador();
        actualizarEstadoVisual();
        requestAnimationFrame(loop); // empieza la lógica

        function calcularGanancia() {
            let dias = parseInt(document.getElementById("diasInput").value);
            if (!isNaN(dias) && dias > 0) {
                let segundosTotales = dias * 60 * 60 * 8;
                let ganancia = segundosTotales * incrementoPorSegundo;
                document.getElementById("resultadoGanancia").textContent =
                    `Ganancia estimada en ${dias} día(s): ${ganancia.toFixed(2)} €`;
            } else {
                alert("Introduce un número válido de días.");
            }
        }

        function calcularGananciaHoras() {
            let horas = parseInt(document.getElementById("horasInput").value);
            if (!isNaN(horas) && horas > 0) {
                let segundosTotales = horas * 60 * 60;
                let ganancia = segundosTotales * incrementoPorSegundo;
                document.getElementById("resultadoGananciaHoras").textContent =
                    `Ganancia estimada en ${horas} hora(s): ${ganancia.toFixed(2)} €`;
            } else {
                alert("Introduce un número válido de horas.");
            }
        }

        function calcularGananciaMinutos() {
            let minutos = parseInt(document.getElementById("minutosInput").value);
            if (!isNaN(minutos) && minutos > 0) {
                let segundosTotales = minutos * 60;
                let ganancia = segundosTotales * incrementoPorSegundo;
                document.getElementById("resultadoGananciaMinutos").textContent =
                    `Ganancia estimada en ${minutos} hora(s): ${ganancia.toFixed(2)} €`;
            } else {
                alert("Introduce un número válido de minutos.");
            }
        }



        //Inverso



        let modoInverso = false;

        function alternarModo() {
            modoInverso = !modoInverso;

            document.getElementById("calculadoraNormal").style.display = modoInverso ? "none" : "block";
            document.getElementById("calculadoraInversa").style.display = modoInverso ? "block" : "none";
        }
        function agregarDineroDesdeInverso() {
            const monto = parseFloat(document.getElementById("montoInverso").value);
            if (!isNaN(monto) && monto > 0) {
                valor += monto;
                actualizarContador();
                document.getElementById("montoInverso").value = "";
                document.getElementById("resultadoInverso").innerHTML = "";
                document.getElementById("btnAgregarInverso").style.display = "none";
            }
        }


        function calcularInverso() {
            const monto = parseFloat(document.getElementById("montoInverso").value);
            const resultadoDiv = document.getElementById("resultadoInverso");
            const botonAgregar = document.getElementById("btnAgregarInverso");

            resultadoDiv.innerHTML = "";
            botonAgregar.style.display = "none";

            if (isNaN(monto) || monto <= 0) {
                resultadoDiv.textContent = "Introduce un monto válido mayor a 0.";
                return;
            }



            const segundosTotales = monto / incrementoPorSegundo;

            const dias = Math.floor(segundosTotales / (8 * 60 * 60));
            const restoDespuesDias = segundosTotales % (8 * 60 * 60);

            const horas = Math.floor(restoDespuesDias / (60 * 60));
            const restoDespuesHoras = restoDespuesDias % (60 * 60);

            const minutos = Math.floor(restoDespuesHoras / 60);

            if (dias > 0) resultadoDiv.innerHTML += `🕒 ${dias} jornada(s) de 8h<br>`;
            if (horas > 0) resultadoDiv.innerHTML += `🕓 ${horas} hora(s)<br>`;
            if (minutos > 0) resultadoDiv.innerHTML += `🕔 ${minutos} minuto(s)<br>`;

            if (dias === 0 && horas === 0 && minutos === 0) {
                resultadoDiv.textContent = "Ese monto es demasiado pequeño para representar tiempo.";
            } else {
                botonAgregar.style.display = "inline-block";
            }
        }

        const contenedorCalculadoras = document.getElementById("contenedorCalculadoras");
        const flechaToggle = document.getElementById("flechaToggle");

        flechaToggle.addEventListener("click", () => {
            contenedorCalculadoras.classList.toggle("oculto");

            // Cambiar la flecha visualmente 🔽 ↔ 🔼
            if (contenedorCalculadoras.classList.contains("oculto")) {
                flechaToggle.innerHTML = '<i class="fa-solid fa-plus"></i>';
            } else {
                flechaToggle.innerHTML = '<i class="fa-solid fa-minus"></i>';
            }
        });
    </script>


</body>

</html>